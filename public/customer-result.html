<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Decision Result - Pre-Disposal</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f5f7 0%, #ececf1 100%);
      min-height: 100vh;
      padding: 20px;
    }

    header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      padding: 16px 40px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 20px;
      font-weight: 600;
      color: #1d1d1f;
    }

    nav ul {
      display: flex;
      gap: 32px;
      list-style: none;
    }

    nav a {
      text-decoration: none;
      color: #1d1d1f;
      font-size: 12px;
      opacity: 0.8;
      transition: opacity 0.3s;
    }

    nav a:hover {
      opacity: 1;
    }

    .container {
      max-width: 900px;
      margin: 100px auto 40px;
      background: white;
      border-radius: 24px;
      padding: 48px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .loading {
      text-align: center;
      padding: 60px;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .status-badge {
      display: inline-block;
      background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
      color: white;
      padding: 12px 28px;
      border-radius: 24px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 20px;
      box-shadow: 0 4px 16px rgba(52, 199, 89, 0.3);
    }

    .status-header h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #1d1d1f;
    }

    .status-header p {
      color: #86868b;
      font-size: 17px;
    }

    .decision-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 32px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    }

    .decision-icon {
      font-size: 80px;
      margin-bottom: 20px;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .decision-card h2 {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .decision-card p {
      font-size: 18px;
      line-height: 1.6;
      opacity: 0.95;
    }

    .info-section {
      background: #f5f5f7;
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .info-section h3 {
      font-size: 20px;
      margin-bottom: 20px;
      color: #1d1d1f;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-row {
      display: flex;
      padding: 16px 0;
      border-bottom: 1px solid #e5e5e7;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      width: 180px;
      font-weight: 500;
      color: #86868b;
      font-size: 14px;
    }

    .info-value {
      flex: 1;
      color: #1d1d1f;
      font-size: 15px;
      font-weight: 500;
    }

    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
    }

    .agree-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #34c759;
      color: white;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
    }

    .override-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #ff9500;
      color: white;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
    }

    .admin-notes-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
    }

    .admin-notes-box h4 {
      font-size: 16px;
      color: #856404;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .admin-notes-box p {
      color: #856404;
      line-height: 1.6;
      font-size: 15px;
    }

    .action-steps {
      background: white;
      border: 2px solid #e5e5e7;
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .action-steps h3 {
      font-size: 24px;
      margin-bottom: 24px;
      color: #1d1d1f;
    }

    .step-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .step {
      display: flex;
      align-items: start;
      gap: 16px;
    }

    .step-number {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #007aff 0%, #5856d6 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      flex-shrink: 0;
    }

    .step-content h4 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #1d1d1f;
    }

    .step-content p {
      color: #86868b;
      line-height: 1.6;
      font-size: 15px;
    }

    .button-group {
      display: flex;
      gap: 16px;
      margin-top: 32px;
    }

    .btn {
      flex: 1;
      padding: 16px 32px;
      border: none;
      border-radius: 12px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      text-align: center;
      display: inline-block;
    }

    .btn-primary {
      background: linear-gradient(135deg, #007aff 0%, #5856d6 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
    }

    .btn-secondary {
      background: #f5f5f7;
      color: #1d1d1f;
    }

    .btn-secondary:hover {
      background: #e8e8ed;
    }

    .edu-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 32px;
      border-radius: 16px;
      margin-top: 24px;
    }

    .edu-box h4 {
      font-size: 20px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .edu-box p {
      font-size: 16px;
      line-height: 1.6;
      opacity: 0.95;
    }

    .error-state {
      text-align: center;
      padding: 60px;
    }

    .error-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 32px 24px;
      }

      .button-group {
        flex-direction: column;
      }

      .decision-card h2 {
        font-size: 36px;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo">Pre-Disposal</div>
      <nav>
        <ul>
          <li><a href="customer-dashboard.html">Home</a></li>
          <li><a href="submit_product.html">Submit</a></li>
          <li><a href="customer-dashboard.html#track">Track</a></li>
          <li><a href="customer_service.html">Support</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container" id="content">
    
    <!-- Loading State -->
    <div class="loading" id="loadingState">
      <div class="loading-spinner"></div>
      <h3>Loading your result...</h3>
    </div>

    <!-- Error State -->
    <div class="error-state" id="errorState" style="display: none;">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h2>Error Loading Result</h2>
      <p id="errorMessage"></p>
      <button class="btn btn-primary" onclick="window.location.href='customer-dashboard.html'">‚Üê Back to Dashboard</button>
    </div>

    <!-- Main Content (Hidden until loaded) -->
    <div id="mainContent" style="display: none;">
      <div class="status-header">
        <div class="status-badge">‚úÖ Decision Completed</div>
        <h1>Your Disposal Recommendation</h1>
        <p>We've reviewed your submission and here's our recommendation</p>
      </div>

      <div class="decision-card">
        <div class="decision-icon" id="decisionIcon">‚ôªÔ∏è</div>
        <h2 id="decisionTitle">RECYCLE</h2>
        <p id="decisionDescription">
          Based on our analysis, we recommend recycling your device. 
          This is the most environmentally responsible option for your product.
        </p>
      </div>

      <div class="info-section">
        <h3>üìä Decision Details</h3>
        
        <div class="info-row">
          <div class="info-label">Submission ID:</div>
          <div class="info-value" id="submissionId">#12345</div>
        </div>
        
        <div class="info-row">
          <div class="info-label">Submitted On:</div>
          <div class="info-value" id="submittedDate">Dec 26, 2025</div>
        </div>
        
        <div class="info-row">
          <div class="info-label">AI Recommendation:</div>
          <div class="info-value">
            <span class="ai-badge" id="aiRecommendation">ü§ñ RECYCLE</span>
          </div>
        </div>
        
        <div class="info-row">
          <div class="info-label">Final Decision:</div>
          <div class="info-value">
            <span class="agree-badge" id="adminDecisionBadge">‚úì Agreed with AI</span>
          </div>
        </div>
        
        <div class="info-row">
          <div class="info-label">Reviewed By:</div>
          <div class="info-value" id="reviewedBy">Admin</div>
        </div>
      </div>

      <div class="admin-notes-box" id="notesBox">
        <h4>üí¨ Note from Admin</h4>
        <p id="adminNotes">Loading...</p>
      </div>

      <div class="action-steps" id="nextSteps">
        <h3>üéØ What to Do Next</h3>
        <div class="step-list" id="stepsList">
          <!-- Steps will be dynamically loaded -->
        </div>
      </div>

      <div class="button-group">
        <a href="customer-dashboard.html" class="btn btn-secondary">
          ‚Üê Back to Dashboard
        </a>
        <button class="btn btn-primary" id="actionButton" onclick="handleAction()">
          üîç Find Recycling Center
        </button>
      </div>

      <div class="edu-box" id="eduBox">
        <h4>üí° Did You Know?</h4>
        <p id="eduContent">Loading...</p>
      </div>
    </div>

  </div>

  <script>
    const API_URL = 'http://localhost:4000/api';

    // Decision configurations for all 7 types
    const decisionConfigs = {
      repair: {
        icon: 'üîß',
        title: 'REPAIR',
        description: 'Based on our analysis, we recommend repairing your device. This is a cost-effective solution that extends the life of your product.',
        steps: [
          { title: 'Get a Quote', desc: 'Contact authorized repair centers for repair estimates.' },
          { title: 'Compare Costs', desc: 'Ensure repair cost is reasonable compared to replacement value.' },
          { title: 'Schedule Repair', desc: 'Book an appointment with a certified technician.' },
          { title: 'Quality Check', desc: 'Test all functions after repair to ensure proper operation.' }
        ],
        buttonText: 'üîß Find Repair Centers',
        eduContent: 'Repairing electronics reduces waste and saves resources. A repaired device can serve you for years, avoiding the environmental cost of manufacturing a new one. Plus, you save money!'
      },
      repurpose: {
        icon: 'üî®',
        title: 'REPURPOSE',
        description: 'Your device can be repurposed for a different use! Creative reuse extends its life and reduces waste.',
        steps: [
          { title: 'Research Ideas', desc: 'Look for creative ways to repurpose your device online.' },
          { title: 'Assess Capabilities', desc: 'Identify which features still work and can be useful.' },
          { title: 'Transform It', desc: 'Convert your device into something new (media player, security camera, etc.).' },
          { title: 'Enjoy New Use', desc: 'Put your repurposed device to work in its new role!' }
        ],
        buttonText: 'üí° Explore Repurpose Ideas',
        eduContent: 'Repurposing is creative recycling! Old phones become security cameras, tablets turn into digital photo frames, and laptops become media servers. Every repurposed device is one less in a landfill.'
      },
      reuse: {
        icon: 'üîÑ',
        title: 'RESELL / TRADE-IN',
        description: 'Your device has value! Consider reselling or trading it in to give it a second life with someone else.',
        steps: [
          { title: 'Backup Data', desc: 'Save all important files, photos, and contacts.' },
          { title: 'Factory Reset', desc: 'Erase all personal data from the device.' },
          { title: 'Clean & Package', desc: 'Clean the device and gather original accessories if available.' },
          { title: 'List or Trade', desc: 'Post on resale platforms or visit trade-in programs.' }
        ],
        buttonText: 'üí∞ Find Trade-In Programs',
        eduContent: 'The resale market keeps devices in use longer, reducing electronic waste. Your "old" device might be perfect for someone else. Trade-in programs often offer store credit or cash!'
      },
      donate: {
        icon: 'üéÅ',
        title: 'DONATE / GIVE AWAY',
        description: 'Your device can help someone in need! Donating extends its useful life and supports your community.',
        steps: [
          { title: 'Backup Data', desc: 'Save all important information from your device.' },
          { title: 'Factory Reset', desc: 'Remove all personal data completely.' },
          { title: 'Find Recipients', desc: 'Locate charities, schools, or community programs that accept devices.' },
          { title: 'Donate', desc: 'Give your device to someone who can benefit from it.' }
        ],
        buttonText: 'üéÅ Find Donation Centers',
        eduContent: 'Donating electronics bridges the digital divide. Students, nonprofits, and underserved communities often need devices. Your donation could enable education, job searches, or staying connected with loved ones.'
      },
      rent: {
        icon: 'üí∞',
        title: 'RENT',
        description: 'Consider renting out your device temporarily. This generates income while keeping it in use!',
        steps: [
          { title: 'Check Condition', desc: 'Ensure your device is in good working condition.' },
          { title: 'Set Terms', desc: 'Decide rental duration, price, and conditions.' },
          { title: 'List on Platforms', desc: 'Use rental marketplace apps or local community boards.' },
          { title: 'Manage Rental', desc: 'Coordinate with renters and maintain the device.' }
        ],
        buttonText: 'üì± Explore Rental Platforms',
        eduContent: 'Renting promotes the sharing economy, where products are used more efficiently. Instead of sitting unused, your device generates income while serving others who need it temporarily.'
      },
      recycle: {
        icon: '‚ôªÔ∏è',
        title: 'RECYCLE',
        description: 'Based on our analysis, we recommend recycling your device. This is the most environmentally responsible option for your product.',
        steps: [
          { title: 'Backup Your Data', desc: 'Save any important photos, contacts, or files from your device.' },
          { title: 'Factory Reset', desc: 'Perform a factory reset to erase all personal data.' },
          { title: 'Find Recycling Center', desc: 'Visit one of our certified recycling partners nearby.' },
          { title: 'Drop Off Device', desc: 'Bring your device to the center. Most offer free recycling!' }
        ],
        buttonText: 'üîç Find Recycling Center',
        eduContent: 'Recycling electronics recovers valuable materials like gold, silver, and copper for reuse in new products. It also prevents toxic substances from contaminating the environment. Thank you for making an environmentally responsible choice!'
      },
      retain: {
        icon: '‚úÖ',
        title: 'RETAIN',
        description: 'Your device is still in good condition! Continue using it to maximize its lifespan.',
        steps: [
          { title: 'Maintain Regularly', desc: 'Keep your device clean and updated with latest software.' },
          { title: 'Use Protective Gear', desc: 'Consider cases and screen protectors to prevent damage.' },
          { title: 'Optimize Performance', desc: 'Clear cache, remove unused apps, and manage storage.' },
          { title: 'Monitor Health', desc: 'Watch battery life and performance for signs of degradation.' }
        ],
        buttonText: 'üì± Device Care Tips',
        eduContent: 'The longest-lasting device is the one you already own! Proper maintenance extends device life significantly, reducing waste and saving money. Regular care keeps your device running smoothly for years.'
      }
    };

    async function loadDecisionData() {
      // Get submission ID from URL
      const params = new URLSearchParams(window.location.search);
      const submissionId = params.get('id');

      if (!submissionId) {
        showError('No submission ID provided. Please access this page from your dashboard.');
        return;
      }

      try {
        console.log('Fetching result for submission:', submissionId);
        
        // Fetch from the customer result API endpoint
        const response = await fetch(`${API_URL}/customer-result/${submissionId}`);
        
        if (!response.ok) {
          throw new Error(`Failed to load result: ${response.status}`);
        }

        const data = await response.json();
        console.log('Received data:', data);

        // Extract the decision from admin_decision or ai_decision
        const finalDecision = data.admin_decision || data.ai_decision || 'recycle';
        const aiDecision = data.ai_decision || finalDecision;
        const adminAgreed = data.admin_agreed || (finalDecision === aiDecision);
        const adminNotes = data.admin_notes || 'No additional notes provided.';
        const reviewedBy = data.status === 'approved' ? 'Admin' : 'Pending Review';

        const decisionData = {
          decision: finalDecision.toLowerCase(),
          aiRecommendation: aiDecision.toLowerCase(),
          adminAgreed: adminAgreed,
          adminNotes: adminNotes,
          reviewedBy: reviewedBy,
          submissionId: submissionId,
          submittedAt: data.submitted_at
        };

        console.log('Processed decision data:', decisionData);

        updateUI(decisionData);

      } catch (error) {
        console.error('Error loading result:', error);
        showError(error.message);
      }
    }

    function updateUI(data) {
      const config = decisionConfigs[data.decision];
      
      if (!config) {
        console.error('Unknown decision type:', data.decision);
        showError(`Unknown decision type: ${data.decision}`);
        return;
      }

      // Hide loading, show content
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';

      // Update decision card
      document.getElementById('decisionIcon').textContent = config.icon;
      document.getElementById('decisionTitle').textContent = config.title;
      document.getElementById('decisionDescription').textContent = config.description;

      // Update submission details
      document.getElementById('submissionId').textContent = '#' + data.submissionId.substring(0, 8);
      document.getElementById('submittedDate').textContent = data.submittedAt ? new Date(data.submittedAt).toLocaleDateString() : 'N/A';
      document.getElementById('reviewedBy').textContent = data.reviewedBy;

      // Update AI recommendation
      document.getElementById('aiRecommendation').textContent = `ü§ñ ${data.aiRecommendation.toUpperCase()}`;

      // Update admin decision badge
      const adminBadge = document.getElementById('adminDecisionBadge');
      if (data.adminAgreed) {
        adminBadge.className = 'agree-badge';
        adminBadge.textContent = '‚úì Agreed with AI';
      } else {
        adminBadge.className = 'override-badge';
        adminBadge.textContent = '‚ö† Admin Override: ' + data.decision.toUpperCase();
      }

      // Update admin notes
      document.getElementById('adminNotes').textContent = data.adminNotes;

      // Update next steps
      const stepsList = document.getElementById('stepsList');
      stepsList.innerHTML = config.steps.map((step, index) => `
        <div class="step">
          <div class="step-number">${index + 1}</div>
          <div class="step-content">
            <h4>${step.title}</h4>
            <p>${step.desc}</p>
          </div>
        </div>
      `).join('');

      // Update action button
      document.getElementById('actionButton').textContent = config.buttonText;

      // Update educational content
      document.getElementById('eduContent').textContent = config.eduContent;
    }

    function showError(message) {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('mainContent').style.display = 'none';
      document.getElementById('errorState').style.display = 'block';
      document.getElementById('errorMessage').textContent = message;
    }

    function handleAction() {
      alert('üó∫Ô∏è Opening relevant resources...\n\nThis feature will connect you with the appropriate services based on your decision!');
    }

    // Load data on page load
    window.addEventListener('DOMContentLoaded', loadDecisionData);
  </script>

</body>
</html>